<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Docker基础 - A Programmer&#39;s Home</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Weixin" />
  <meta name="description" content="Docker基础 安装与配置 安装 步骤 下载&amp;amp;安装 1 2 3 # https://download.docker.com/linux/static/stable/ curl https://download.docker.com/linux/static/stable/x86_64/docker-19.03.5.tgz -o docker-19.03.5.tgz &amp;amp;&amp;amp; mkdir docker &amp;amp;&amp;amp; tar xzf docker-19.03.5.tgz -C docker --strip-components=1 sudo mv docker /usr/local/bin 启动 1 2 3 4 5 6 7 8 # 1. Start the Docker daemon sudo dockerd &amp;amp; # 2." />

  <meta name="keywords" content="Code, Share, OpenSource" />






<meta name="generator" content="Hugo 0.72.0" />


<link rel="canonical" href="https://yanweixin.github.io/post/docker-basics/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa3d941d1d0e0ddc985804227feabffea55c89883eb0af34e0532a7ae9135151.css" integrity="sha256-&#43;j2UHR0ODdyYWAQif&#43;q//qVciYg&#43;sK804FMqeukTUVE=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Docker基础" />
<meta property="og:description" content="Docker基础 安装与配置 安装 步骤 下载&amp;安装 1 2 3 # https://download.docker.com/linux/static/stable/ curl https://download.docker.com/linux/static/stable/x86_64/docker-19.03.5.tgz -o docker-19.03.5.tgz &amp;&amp; mkdir docker &amp;&amp; tar xzf docker-19.03.5.tgz -C docker --strip-components=1 sudo mv docker /usr/local/bin 启动 1 2 3 4 5 6 7 8 # 1. Start the Docker daemon sudo dockerd &amp; # 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yanweixin.github.io/post/docker-basics/" />
<meta property="article:published_time" content="2019-06-20T08:11:06+08:00" />
<meta property="article:modified_time" content="2019-06-20T08:11:06+08:00" />
<meta itemprop="name" content="Docker基础">
<meta itemprop="description" content="Docker基础 安装与配置 安装 步骤 下载&amp;安装 1 2 3 # https://download.docker.com/linux/static/stable/ curl https://download.docker.com/linux/static/stable/x86_64/docker-19.03.5.tgz -o docker-19.03.5.tgz &amp;&amp; mkdir docker &amp;&amp; tar xzf docker-19.03.5.tgz -C docker --strip-components=1 sudo mv docker /usr/local/bin 启动 1 2 3 4 5 6 7 8 # 1. Start the Docker daemon sudo dockerd &amp; # 2.">
<meta itemprop="datePublished" content="2019-06-20T08:11:06&#43;08:00" />
<meta itemprop="dateModified" content="2019-06-20T08:11:06&#43;08:00" />
<meta itemprop="wordCount" content="13891">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker基础"/>
<meta name="twitter:description" content="Docker基础 安装与配置 安装 步骤 下载&amp;安装 1 2 3 # https://download.docker.com/linux/static/stable/ curl https://download.docker.com/linux/static/stable/x86_64/docker-19.03.5.tgz -o docker-19.03.5.tgz &amp;&amp; mkdir docker &amp;&amp; tar xzf docker-19.03.5.tgz -C docker --strip-components=1 sudo mv docker /usr/local/bin 启动 1 2 3 4 5 6 7 8 # 1. Start the Docker daemon sudo dockerd &amp; # 2."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-140868062-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Coder</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yanweixin.github.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yanweixin.github.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yanweixin.github.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yanweixin.github.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://gohugo.io" rel="noopener" target="_blank">
              external-link
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
      <li class="mobile-menu-item">
        <a id="openSearchMobile" class="mobile-menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  
    
<div class="modal-dialog">
    
    <div class="modal-content">
      <div id="closeSearch" title="Close" class="close">X</div>
      <div class="modal-header">
        <div class="modal-title">Search</div>
      </div>
      <div class="modal-body">
          <script>
            (function() {
              var cx = '016772707527870234150:3olmavgy4bm';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = (document.location.protocol == 'https:' ? 'https:' :
                  'http:') +
                '//cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
      </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Coder
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://yanweixin.github.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://yanweixin.github.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://yanweixin.github.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://yanweixin.github.io/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://gohugo.io" rel="noopener" target="_blank">
              external-link
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
      <li class="menu-item">
        <a id="openSearch" class="menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Docker基础</h1>
      
      <div class="post-meta">
        <time datetime="2019-06-20" class="post-time">
          2019-06-20
        </time>
        <div class="post-category">
            <a href="https://yanweixin.github.io/categories/server/"> server </a>
            
          </div>
        <span class="more-meta"> 13891 words </span>
          <span class="more-meta"> 28 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#安装与配置">安装与配置</a>
      <ul>
        <li><a href="#安装">安装</a></li>
        <li><a href="#配置">配置</a></li>
        <li><a href="#故障排除">故障排除</a></li>
      </ul>
    </li>
    <li><a href="#使用">使用</a>
      <ul>
        <li><a href="#起步">起步</a></li>
        <li><a href="#配置容器">配置容器</a></li>
      </ul>
    </li>
    <li><a href="#开发">开发</a>
      <ul>
        <li><a href="#快速开始">快速开始</a></li>
        <li><a href="#最佳实践">最佳实践</a></li>
      </ul>
    </li>
    <li><a href="#配置网络">配置网络</a></li>
    <li><a href="#管理应用数据">管理应用数据</a>
      <ul>
        <li><a href="#选择正确的类型">选择正确的类型</a></li>
        <li><a href="#volumes">Volumes</a></li>
      </ul>
    </li>
    <li><a href="#生产环境运行">生产环境运行</a>
      <ul>
        <li><a href="#docker对象标签">Docker对象标签</a></li>
        <li><a href="#清理未使用的docker对象">清理未使用的Docker对象</a></li>
        <li><a href="#格式化命令并输出日志">格式化命令并输出日志</a></li>
        <li><a href="#安全">安全</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h1 id="docker基础">Docker基础</h1>
<h2 id="安装与配置">安装与配置</h2>
<h3 id="安装">安装</h3>
<h4 id="步骤">步骤</h4>
<ol>
<li>下载&amp;安装</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># https://download.docker.com/linux/static/stable/</span>
curl https://download.docker.com/linux/static/stable/x86_64/docker-19.03.5.tgz -o docker-19.03.5.tgz <span class="o">&amp;&amp;</span> mkdir docker <span class="o">&amp;&amp;</span> tar xzf docker-19.03.5.tgz -C docker --strip-components<span class="o">=</span><span class="m">1</span>
sudo mv docker /usr/local/bin
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>启动</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 1. Start the Docker daemon</span>
sudo dockerd <span class="p">&amp;</span>
<span class="c1"># 2. Start the daemon with additional options</span>
<span class="c1"># modify the above command accordingly or create and edit the file /etc/docker/daemon.json to add the custom configuration options</span>
touch /usr/local/bin/docker/daemon.json 
sudo dockerd --config-file<span class="o">=</span>/usr/local/bin/docker/daemon.json

docker run -d -v &lt;host-directory&gt;:/certs -p 2375:2375 swarm manage --tlsverify --tlscacert<span class="o">=</span>/certs/ca.pem --tlscert<span class="o">=</span>/certs/cert.pem --tlskey<span class="o">=</span>/certs/key.pem token://&lt;token&gt;
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>测试</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">docker run hello-world
<span class="c1"># Or</span>
docker -H &lt;hostname&gt; run hello-world
</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>升级</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 1. 停止dockerd</span>
Ctrl+C
<span class="c1"># 2. 安装新版本</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="命令概括">命令概括</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">## List Docker CLI commands</span>
docker
docker container --help

<span class="c1">## Display Docker version and info</span>
docker --version
docker version
docker info

<span class="c1">## Execute Docker image</span>
docker run hello-world

<span class="c1">## List Docker images</span>
docker image ls

<span class="c1">## List Docker containers (running, all, all in quiet mode)</span>
docker container ls
docker container ls --all
docker container ls -aq
</code></pre></td></tr></table>
</div>
</div><h4 id="使用非root用户">使用非root用户</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 创建Docker用户组</span>
sudo groupadd docker
<span class="c1"># 将自己添加到用户组</span>
sudo usermod -aG docker <span class="nv">$USER</span> <span class="c1">#sudo gpasswd -a $USER docker</span>
<span class="c1"># 退出重新登录使更改生效，可以重启虚拟机，Linux上可使用如下命令：</span>
newgrp docker
<span class="c1"># 测试</span>
docker run hello-world
</code></pre></td></tr></table>
</div>
</div><p>如果在将自己添加到docker用户组之前使用<code>sudo</code>运行了Docker CLI命令，可能看到如下错误，因为<code>sudo</code>命令导致之前创建的<code>~/.docker/</code>目录权限不足。</p>
<pre><code>WARNING: Error loading config file: /home/user/.docker/config.json -
stat /home/user/.docker/config.json: permission denied
</code></pre>
<p>要解决此问题，要么移除<code>~/.docker/</code>(稍后会自动重建，但是所有个性化设置都会丢失。)，要么使用如下命令更改权限</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo chown <span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span>:<span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span> /home/<span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span>/.docker -R
sudo chmod g+rwx <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.docker&#34;</span> -R
</code></pre></td></tr></table>
</div>
</div><h3 id="配置">配置</h3>
<p>有两种方式配置daemon，一种是使用JSON配置文件（推荐），一种是在启动<code>dockerd</code>时添加标志。如果同时使用两种方式，而相同选项配置不同，daemon不会启动，而是输出错误信息。</p>
<p>比如以下命令行和JSON方式配置daemon的方式是等效的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JSON" data-lang="JSON"><span class="p">{</span>
  <span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&#34;tls&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&#34;tlscert&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/docker/server.pem&#34;</span><span class="p">,</span>
  <span class="nt">&#34;tlskey&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/docker/serverkey.pem&#34;</span><span class="p">,</span>
  <span class="nt">&#34;hosts&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;tcp://192.168.59.3:2376&#34;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">dockerd --debug <span class="se">\
</span><span class="se"></span>  --tls<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span><span class="se"></span>  --tlscert<span class="o">=</span>/var/docker/server.pem <span class="se">\
</span><span class="se"></span>  --tlskey<span class="o">=</span>/var/docker/serverkey.pem <span class="se">\
</span><span class="se"></span>  --host tcp://192.168.59.3:2376
</code></pre></td></tr></table>
</div>
</div><p>在Linux上使用JSON配置，创建<code>/etc/docker/daemon.json</code>文件，在Windows上则创建<code>C:\ProgramData\docker\config\daemon.json</code>，在macOS上选择<code>Preferences &gt; Daemon &gt; Advanced</code>。</p>
<h4 id="daemonjson示例">daemon.json示例</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;authorization-plugins&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;data-root&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/local/bin/docker/data&#34;</span><span class="p">,</span>
	<span class="nt">&#34;dns&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;dns-opts&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;dns-search&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;exec-opts&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;exec-root&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/local/bin/docker/run&#34;</span><span class="p">,</span>
	<span class="nt">&#34;experimental&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;features&#34;</span><span class="p">:</span> <span class="p">{},</span>
	<span class="nt">&#34;storage-driver&#34;</span><span class="p">:</span> <span class="s2">&#34;overlay2&#34;</span><span class="p">,</span>
	<span class="nt">&#34;storage-opts&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;labels&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;live-restore&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="nt">&#34;log-driver&#34;</span><span class="p">:</span> <span class="s2">&#34;json-file&#34;</span><span class="p">,</span>
	<span class="nt">&#34;log-opts&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;max-size&#34;</span><span class="p">:</span> <span class="s2">&#34;10m&#34;</span><span class="p">,</span>
		<span class="nt">&#34;max-file&#34;</span><span class="p">:</span><span class="s2">&#34;5&#34;</span><span class="p">,</span>
		<span class="nt">&#34;labels&#34;</span><span class="p">:</span> <span class="s2">&#34;production_status&#34;</span><span class="p">,</span>
		<span class="nt">&#34;env&#34;</span><span class="p">:</span> <span class="s2">&#34;os,customer&#34;</span>
	<span class="p">},</span>
	<span class="nt">&#34;mtu&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
	<span class="nt">&#34;pidfile&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/local/bin/docker/run/docker.pid&#34;</span><span class="p">,</span>
	<span class="nt">&#34;cluster-store&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;cluster-store-opts&#34;</span><span class="p">:</span> <span class="p">{},</span>
	<span class="nt">&#34;cluster-advertise&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;max-concurrent-downloads&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
	<span class="nt">&#34;max-concurrent-uploads&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
	<span class="nt">&#34;default-shm-size&#34;</span><span class="p">:</span> <span class="s2">&#34;64M&#34;</span><span class="p">,</span>
	<span class="nt">&#34;shutdown-timeout&#34;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
	<span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="nt">&#34;hosts&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;unix:///var/run/docker.sock&#34;</span><span class="p">,</span> <span class="s2">&#34;tcp://127.0.0.1:2375&#34;</span><span class="p">],</span>
	<span class="nt">&#34;log-level&#34;</span><span class="p">:</span> <span class="s2">&#34;info&#34;</span><span class="p">,</span>
	<span class="nt">&#34;tls&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="nt">&#34;tlsverify&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="nt">&#34;tlscacert&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;tlscert&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;tlskey&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;swarm-default-advertise-addr&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;api-cors-header&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;selinux-enabled&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;userns-remap&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;group&#34;</span><span class="p">:</span> <span class="s2">&#34;docker&#34;</span><span class="p">,</span>
	<span class="nt">&#34;cgroup-parent&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;default-ulimits&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;nofile&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;nofile&#34;</span><span class="p">,</span>
			<span class="nt">&#34;Hard&#34;</span><span class="p">:</span> <span class="mi">64000</span><span class="p">,</span>
			<span class="nt">&#34;Soft&#34;</span><span class="p">:</span> <span class="mi">64000</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="nt">&#34;init&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;init-path&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/local/bin/docker/docker-init&#34;</span><span class="p">,</span>
	<span class="nt">&#34;ipv6&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;iptables&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="nt">&#34;ip-forward&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;ip-masq&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;userland-proxy&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;userland-proxy-path&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/local/bin/docker/docker-proxy&#34;</span><span class="p">,</span>
	<span class="nt">&#34;ip&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span>
	<span class="nt">&#34;bridge&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;bip&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;fixed-cidr&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;fixed-cidr-v6&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;default-gateway&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;default-gateway-v6&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;icc&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;raw-logs&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;allow-nondistributable-artifacts&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;registry-mirrors&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;https://registry.docker-cn.com&#34;</span><span class="p">,</span><span class="s2">&#34;https://yourid.mirror.aliyuncs.com&#34;</span><span class="p">],</span>
	<span class="nt">&#34;seccomp-profile&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
	<span class="nt">&#34;insecure-registries&#34;</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nt">&#34;no-new-privileges&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="nt">&#34;default-runtime&#34;</span><span class="p">:</span> <span class="s2">&#34;runc&#34;</span><span class="p">,</span>
	<span class="nt">&#34;oom-score-adjust&#34;</span><span class="p">:</span> <span class="mi">-500</span><span class="p">,</span>
	<span class="nt">&#34;node-generic-resources&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;NVIDIA-GPU=UUID1&#34;</span><span class="p">,</span> <span class="s2">&#34;NVIDIA-GPU=UUID2&#34;</span><span class="p">],</span>
	<span class="nt">&#34;runtimes&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;cc-runtime&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/bin/cc-runtime&#34;</span>
		<span class="p">},</span>
		<span class="nt">&#34;custom&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/local/bin/my-runc-replacement&#34;</span><span class="p">,</span>
			<span class="nt">&#34;runtimeArgs&#34;</span><span class="p">:</span> <span class="p">[</span>
				<span class="s2">&#34;--debug&#34;</span>
			<span class="p">]</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="nt">&#34;default-address-pools&#34;</span><span class="p">:[{</span><span class="nt">&#34;base&#34;</span><span class="p">:</span><span class="s2">&#34;172.80.0.0/16&#34;</span><span class="p">,</span><span class="nt">&#34;size&#34;</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span>
	<span class="p">{</span><span class="nt">&#34;base&#34;</span><span class="p">:</span><span class="s2">&#34;172.90.0.0/16&#34;</span><span class="p">,</span><span class="nt">&#34;size&#34;</span><span class="p">:</span><span class="mi">24</span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="配置docker守护进程监听">配置Docker守护进程监听</h4>
<p>默认情况下，Docker守护程序在UNIX套接字上侦听连接以接受来自本地客户端的请求。通过将Docker配置为侦听IP地址和端口以及UNIX套接字，可以允许Docker接受来自远程主机的请求。</p>
<p>可以使用<code>docker.service</code> systemd单元文件来配置Docker来接受远程连接，该文件用于使用<code>systemd</code>的Linux发行版，例如RedHat，CentOS，Ubuntu和SLES的最新版本，或者通过<code>daemon.json</code>文件，推荐用于没有<code>systemd</code>的Linux发行版。</p>
<p><strong>systemd vs daemon.json</strong></p>
<p>将Docker配置为同时使用<code>systemd</code>单元文件和<code>daemon.json</code>文件监听连接会导致冲突，从而阻止Docker启动。</p>
<h5 id="使用systemd单元文件配置远程访问">使用systemd单元文件配置远程访问</h5>
<p>使用<code>sudo systemctl edit docker.service</code>命令在文本编辑器打开<code>docker.service</code>覆写文件。</p>
<p>添加如下行，或替换为自己的内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[</span><span class="nx">Service</span><span class="p">]</span>
<span class="nx">ExecStart</span><span class="p">=</span>
<span class="nx">ExecStart</span><span class="p">=</span><span class="err">/</span><span class="nx">usr</span><span class="err">/</span><span class="nx">bin</span><span class="err">/</span><span class="nx">dockerd</span> <span class="err">-</span><span class="nx">H</span> <span class="nx">fd</span><span class="err">://</span> <span class="err">-</span><span class="nx">H</span> <span class="nx">tcp</span><span class="err">://</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="err">:</span><span class="mi">2375</span>
</code></pre></td></tr></table>
</div>
</div><p>保存文件，重载配置并重启Docker</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo systemctl daemon-reload
sudo systemctl restart docker.service
</code></pre></td></tr></table>
</div>
</div><p>通过<code>netstat</code>命令查看输出以确认<code>dockerd</code>正在监听配置的端口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo netstat -lntp <span class="p">|</span> grep dockerd
tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:2375          0.0.0.0:*               LISTEN      3758/dockerd
</code></pre></td></tr></table>
</div>
</div><h5 id="使用daemonjson配置远程访问">使用daemon.json配置远程访问</h5>
<p>设置<code>/etc/docker/daemon.json</code>中的<code>hosts</code>数组以连接到一个UNIX套接字和一个IP地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
<span class="nt">&#34;hosts&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;unix:///var/run/docker.sock&#34;</span><span class="p">,</span> <span class="s2">&#34;tcp://127.0.0.1:2375&#34;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>重启Docker并使用<code>netstat</code>命令确认<code>dockerd</code>正在监听配置的端口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo netstat -lntp <span class="p">|</span> grep dockerd
tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:2375          0.0.0.0:*               LISTEN      3758/dockerd
</code></pre></td></tr></table>
</div>
</div><p>如果启动失败，显示配置冲突，那么新建<code>/etc/systemd/system/docker.service.d/docker.conf</code>文件，移除默认<code>-H</code>参数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[</span><span class="nx">Service</span><span class="p">]</span>
<span class="nx">ExecStart</span><span class="p">=</span>
<span class="nx">ExecStart</span><span class="p">=</span><span class="err">/</span><span class="nx">usr</span><span class="err">/</span><span class="nx">bin</span><span class="err">/</span><span class="nx">dockerd</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="故障排除">故障排除</h3>
<h4 id="kernel兼容性">Kernel兼容性</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ curl https://raw.githubusercontent.com/docker/docker/master/contrib/check-config.sh &gt; check-config.sh

$ bash ./check-config.sh
</code></pre></td></tr></table>
</div>
</div><h4 id="检查日志">检查日志</h4>
<table>
<thead>
<tr>
<th>系统</th>
<th>位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>RHEL, Oracle Linux</td>
<td>/var/log/messages</td>
</tr>
<tr>
<td>Debian</td>
<td>/var/log/daemon.log</td>
</tr>
<tr>
<td>Ubuntu 16.04+, CentOS</td>
<td>Use the command <code>journalctl -u docker.service</code></td>
</tr>
<tr>
<td>macOS (Docker 18.01+)</td>
<td>~/Library/Containers/com.docker.docker/Data/vms/0/console-ring</td>
</tr>
<tr>
<td>Windows</td>
<td>AppData\Local</td>
</tr>
</tbody>
</table>
<h2 id="使用">使用</h2>
<h3 id="起步">起步</h3>
<h4 id="启用debug">启用debug</h4>
<p>推荐创建或编辑<code>/etc/docker/</code>下的<code>daemon.json</code>文件，在Windows或macOS上不要直接编辑，而是选择<code>Preferences / Daemon / Advanced</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>确认<code>log-level</code>键也设置了值，使用<code>info</code>（默认）或<code>debug</code>，可用的值有<code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, <code>fatal</code>。</p>
<p>最后发送HUP信号给daemon以让它重新加载配置，在Windows上重启Docker，在Linux上使用如下命令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo <span class="nb">kill</span> -SIGHUP <span class="k">$(</span>pidof dockerd<span class="k">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果守护程序无响应，则可以通过向守护程序发送<code>SIGUSR1</code>信号来强制记录完整的堆栈跟踪。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo <span class="nb">kill</span> -SIGUSR1 <span class="k">$(</span>pidof dockerd<span class="k">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="测试安装">测试安装</h4>
<ol>
<li>运行docker &ndash;version</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">docker --version
Docker version 18.09.4, build d14af54
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>运行docker info (或者docker version)</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 需先启动Docker</span>
docker info

Containers: <span class="m">0</span>
 Running: <span class="m">0</span>
 Paused: <span class="m">0</span>
 Stopped: <span class="m">0</span>
Images: <span class="m">0</span>
Server Version: 17.12.0-ce
Storage Driver: overlay2
...
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>也可以使用系统工具检查</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo systemctl is-active docker
<span class="c1"># Or</span>
sudo status docker
<span class="c1"># Or</span>
sudo service docker status
</code></pre></td></tr></table>
</div>
</div><h4 id="使用systemd管理docker">使用systemd管理docker</h4>
<p>手动启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># systemctl:</span>
$ sudo systemctl start docker
<span class="c1"># service:</span>
$ sudo service docker start
</code></pre></td></tr></table>
</div>
</div><p>开机启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Enable boot start</span>
sudo systemctl <span class="nb">enable</span> docker
<span class="c1"># Disable boot start</span>
sudo systemctl disable docker
</code></pre></td></tr></table>
</div>
</div><h4 id="httphttps-proxy">HTTP/HTTPS proxy</h4>
<p>Docker守护程序在其启动环境中使用<code>HTTP_PROXY</code>，<code>HTTPS_PROXY</code>和<code>NO_PROXY</code>环境变量来配置HTTP或HTTPS代理行为。您不能使用daemon.json文件配置这些环境变量。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo mkdir -p /etc/systemd/system/docker.service.d
</code></pre></td></tr></table>
</div>
</div><p>创建文件<code>/etc/systemd/system/docker.service.d/http-proxy.conf</code>，添加HTTP_PROXY环境变量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[</span><span class="nx">Service</span><span class="p">]</span>
<span class="nx">Environment</span><span class="p">=</span><span class="s2">&#34;HTTP_PROXY=http://proxy.example.com:80/&#34;</span>
<span class="c"># HTTPS</span>
<span class="p">[</span><span class="nx">Service</span><span class="p">]</span>
<span class="nx">Environment</span><span class="p">=</span><span class="s2">&#34;HTTPS_PROXY=https://proxy.example.com:443/&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>如果您需要在不使用代理的情况下联系内部Docker注册表，则可以通过<code>NO_PROXY</code>环境变量指定它们。</p>
<p>NO_PROXY变量指定一个字符串，该字符串包含用逗号分隔的主机值，该值应排除在代理之外。您可以指定以下选项来排除主机：</p>
<ul>
<li>IP地址前缀(1.2.3.4)</li>
<li>域名或特殊的DNS标签(*)</li>
<li>域名与该名称和所有子域匹配。 以“.”开头的域名仅与子域匹配。例如，给定域<code>foo.example.com</code>和<code>example.com</code>：
<ul>
<li><code>example.com</code>匹配<code>example.com</code>和<code>foo.example.com</code></li>
<li><code>.example.com</code>仅匹配<code>foo.example.com</code></li>
</ul>
</li>
<li>单个星号(*)表示不应进行代理</li>
<li>IP地址前缀(1.2.3.4:80)和域名(foo.example.com:80)接受端口号。</li>
</ul>
<p>例子</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[</span><span class="nx">Service</span><span class="p">]</span>    
<span class="nx">Environment</span><span class="p">=</span><span class="s2">&#34;HTTP_PROXY=http://proxy.example.com:80/&#34;</span> <span class="s2">&#34;NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp&#34;</span>
<span class="c"># HTTPS</span>
<span class="p">[</span><span class="nx">Service</span><span class="p">]</span>    
<span class="nx">Environment</span><span class="p">=</span><span class="s2">&#34;HTTPS_PROXY=https://proxy.example.com:443/&#34;</span> <span class="s2">&#34;NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>后续步骤：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 刷新变化</span>
sudo systemctl daemon-reload
<span class="c1"># 重启docker</span>
sudo systemctl restart docker
<span class="c1"># 确认生效</span>
$ systemctl show --property<span class="o">=</span>Environment docker
<span class="nv">Environment</span><span class="o">=</span><span class="nv">HTTP_PROXY</span><span class="o">=</span>http://proxy.example.com:80/
$ systemctl show --property<span class="o">=</span>Environment docker
<span class="nv">Environment</span><span class="o">=</span><span class="nv">HTTPS_PROXY</span><span class="o">=</span>https://proxy.example.com:443/
</code></pre></td></tr></table>
</div>
</div><h3 id="配置容器">配置容器</h3>
<h4 id="自启动容器">自启动容器</h4>
<p>Docker提供了重启策略来控制您的容器在退出时还是在Docker重新启动时自动启动。重新启动策略确保链接的容器以正确的顺序启动。Docker建议您使用重启策略，并避免使用进程管理器来启动容器。</p>
<p>重新启动策略与dockerd命令的-<code>-live-restore</code>标志不同。 使用<code>--live-restore</code>可以使您的容器在Docker升级期间保持运行，尽管网络和用户输入都会中断。</p>
<p>要为容器配置重启策略，请在使用<code>docker run</code>命令时使用<code>--restart</code>标志。<code>--restart</code>标志的值可以是以下任意值：
|标志|描述|
|&mdash;-|&mdash;|
|no	|不自动重启容器。(默认)|
|on-failure	|如果容器由于错误而退出，重新启动容器，该错误表示为非零退出代码。|
|always	|只要停止总是重启容器。如果手动停止，则仅在Docker守护程序重启或手动重启容器本身时才重启。|
|unless-stopped	|与always相似，除了在容器停止（手动或其他方式）时，即使重新启动Docker守护程序也不会重新启动容器。|</p>
<p>以下示例启动Redis容器并将其配置为始终重新启动，除非明确将其停止或重新启动Docker。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker run -dit --restart unless-stopped redis
</code></pre></td></tr></table>
</div>
</div><p>使用重启策略时，以下几点需铭记在心</p>
<ul>
<li>重新启动策略仅在容器成功启动后才生效。在这种情况下，成功启动意味着该容器已启动至少10秒钟，并且Docker已开始对其进行监视。这样可以防止根本无法启动的容器进入重启循环。</li>
<li>如果手动停止容器，则其重新启动策略将被忽略，直到Docker守护进程重新启动或手动重新启动容器为止。这是防止重新启动循环的另一种尝试。</li>
<li>重新启动策略仅适用于容器。swarm服务的重启策略配置不同。</li>
</ul>
<h4 id="在daemon停机期间使容器保持活动状态">在daemon停机期间使容器保持活动状态</h4>
<p>实时还原(live restore)选项有助于减少由于守护程序崩溃，计划内的停机或升级而导致的容器停机时间。</p>
<p>在<code>/etc/docker/daemon.json</code>文件中添加如下内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;live-restore&#34;</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后重启Docker Daemon。在Linux上，您可以通过重新加载Docker守护程序来避免重启（并避免容器出现任何停机）。如果使用<code>systemd</code>，请使用命令<code>systemctl reload docker</code>。 否则，将<code>SIGHUP</code>信号发送到dockerd进程。</p>
<p>不建议在<code>dockerd</code>命令中使用<code>--live-restore</code>(如果用，不得与上述json配置同时使用)，因为它没有设置启动Docker进程时systemd或其他进程管理器将使用的环境。这可能会导致意外的行为。</p>
<h4 id="在容器中运行多个服务">在容器中运行多个服务</h4>
<p>容器的主要运行进程是Dockerfile末尾的<code>ENTRYPOINT</code>和/或<code>CMD</code>。通常建议您通过每个容器使用一项服务来分离关注区域。该服务可以派生到多个进程中（例如，Apache Web服务器启动多个工作进程）。可以有多个进程，但是要从Docker中获得最大收益，请避免由一个容器来负责整个应用程序的多个方面。您可以使用用户定义的网络和共享卷连接多个容器。</p>
<p>容器的主要进程负责管理其启动的所有进程。在某些情况下，主进程设计不当，并且在容器退出时无法优雅地处理“reaping”（停止）子进程。如果您的进程属于此类别，则在运行容器时可以使用<code>--init</code>选项。 <code>--init</code>标志将一个很小的init进程作为主进程插入到容器中，并在容器退出时处理所有进程的收割。以这种方式处理此类进程优于使用成熟的<code>init</code>进程（例如<code>sysvinit</code>，<code>upstart</code>或<code>systemd</code>）来处理容器中的进程生命周期。</p>
<p>如果您需要在一个容器中运行多个服务，则可以通过几种不同的方式来完成此操作。</p>
<ul>
<li>将所有命令放入包装脚本中，其中包含测试和调试信息。将包装程序脚本作为<code>CMD</code>运行。首先，包装脚本：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
<span class="c1"># Start the first process</span>
./my_first_process -D
<span class="nv">status</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$status</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&#34;Failed to start my_first_process: </span><span class="nv">$status</span><span class="s2">&#34;</span>
  <span class="nb">exit</span> <span class="nv">$status</span>
<span class="k">fi</span>

<span class="c1"># Start the second process</span>
./my_second_process -D
<span class="nv">status</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$status</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&#34;Failed to start my_second_process: </span><span class="nv">$status</span><span class="s2">&#34;</span>
  <span class="nb">exit</span> <span class="nv">$status</span>
<span class="k">fi</span>

<span class="c1"># Naive check runs checks once a minute to see if either of the processes exited.</span>
<span class="c1"># This illustrates part of the heavy lifting you need to do if you want to run</span>
<span class="c1"># more than one service in a container. The container exits with an error</span>
<span class="c1"># if it detects that either of the processes has exited.</span>
<span class="c1"># Otherwise it loops forever, waking up every 60 seconds</span>

<span class="k">while</span> sleep 60<span class="p">;</span> <span class="k">do</span>
  ps aux <span class="p">|</span>grep my_first_process <span class="p">|</span>grep -q -v grep
  <span class="nv">PROCESS_1_STATUS</span><span class="o">=</span><span class="nv">$?</span>
  ps aux <span class="p">|</span>grep my_second_process <span class="p">|</span>grep -q -v grep
  <span class="nv">PROCESS_2_STATUS</span><span class="o">=</span><span class="nv">$?</span>
  <span class="c1"># If the greps above find anything, they exit with 0 status</span>
  <span class="c1"># If they are not both 0, then something is wrong</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$PROCESS_1_STATUS</span> -ne <span class="m">0</span> -o <span class="nv">$PROCESS_2_STATUS</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&#34;One of the processes has already exited.&#34;</span>
    <span class="nb">exit</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="k">FROM</span><span class="s"> ubuntu:latest</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> my_first_process my_first_process<span class="err">
</span><span class="err"></span><span class="k">COPY</span> my_second_process my_second_process<span class="err">
</span><span class="err"></span><span class="k">COPY</span> my_wrapper_script.sh my_wrapper_script.sh<span class="err">
</span><span class="err"></span><span class="k">CMD</span> ./my_wrapper_script.sh<span class="err">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>如果您有一个需要首先启动并保持运行的主要进程，但暂时需要运行其他一些进程（可能与该主要进程进行交互），则可以使用bash的作业控制来简化这一过程。 首先，包装脚本：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
<span class="c1"># turn on bash&#39;s job control</span>
<span class="nb">set</span> -m

<span class="c1"># Start the primary process and put it in the background</span>
./my_main_process <span class="p">&amp;</span>

<span class="c1"># Start the helper process</span>
./my_helper_process

<span class="c1"># the my_helper_process might need to know how to wait on the</span>
<span class="c1"># primary process to start before it does its work and returns</span>


<span class="c1"># now we bring the primary process back into the foreground</span>
<span class="c1"># and leave it there</span>
<span class="nb">fg</span> %1
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="k">FROM</span><span class="s"> ubuntu:latest</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> my_main_process my_main_process<span class="err">
</span><span class="err"></span><span class="k">COPY</span> my_helper_process my_helper_process<span class="err">
</span><span class="err"></span><span class="k">COPY</span> my_wrapper_script.sh my_wrapper_script.sh<span class="err">
</span><span class="err"></span><span class="k">CMD</span> ./my_wrapper_script.sh<span class="err">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>使用进程管理器，例如supervisord。这是一种中等重量的方法，要求您将管理程序及其配置打包在镜像中（或将镜像基于包含管理程序的镜像打包）以及它管理的不同应用程序。 然后，您将启动supervisord，该supervisord将为您管理进程。这是使用此方法的示例<code>Dockerfile</code>，假定预先编写的<code>supervisord.conf</code>，<code>my_first_process</code>和<code>my_second_process</code>文件都与Dockerfile位于同一目录中。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="k">FROM</span><span class="s"> ubuntu:latest</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y supervisor<span class="err">
</span><span class="err"></span><span class="k">RUN</span> mkdir -p /var/log/supervisor<span class="err">
</span><span class="err"></span><span class="k">COPY</span> supervisord.conf /etc/supervisor/conf.d/supervisord.conf<span class="err">
</span><span class="err"></span><span class="k">COPY</span> my_first_process my_first_process<span class="err">
</span><span class="err"></span><span class="k">COPY</span> my_second_process my_second_process<span class="err">
</span><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;/usr/bin/supervisord&#34;</span><span class="p">]</span><span class="err">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="开发">开发</h2>
<h3 id="快速开始">快速开始</h3>
<h4 id="设置您的docker环境">设置您的Docker环境</h4>
<p><strong>镜像和容器</strong>
从根本上说，一个容器不过是一个正在运行的进程，并对其应用了一些附加的封装功能，以使其与主机和其他容器隔离。容器隔离的最重要方面之一是每个容器都与自己的私有文件系统进行交互。该文件系统由Docker<strong>镜像</strong>提供。镜像包括运行应用程序所需的所有内容&ndash;代码或二进制文件，运行时，依赖项以及所需的任何其他文件系统对象。</p>
<p><strong>容器和虚拟机</strong>
容器在Linux上本地运行，并与其他容器共享主机的内核。它运行一个离散进程，不占用任何其他可执行文件更多的内存，从而使其轻巧。</p>
<p>相比之下，虚拟机（VM）运行成熟的“guest”操作系统，并通过虚拟机管理程序对主机资源进行虚拟访问。 通常，VM会产生大量开销，超出了应用程序逻辑所消耗的开销。</p>
<h5 id="安装docker桌面">安装Docker桌面</h5>
<p>通过如下链接安装对应版本的Docker桌面</p>
<ul>
<li><a href="https://docs.docker.com/docker-for-mac/install/">OSX</a></li>
<li><a href="https://docs.docker.com/docker-for-windows/install/">Windows</a></li>
</ul>
<h5 id="启用kubernetes">启用Kubernetes</h5>
<p>打开Docker，在<strong>Preferences&hellip; -&gt; Kubernetes</strong>，勾选<em>Enable Kubernetes</em>，点击<strong>Apply</strong>。Docker桌面将会自动设置Kubernetes。</p>
<p>为了确认Kubernetes已经启动并运行，创建<code>pod.yaml</code>，并添加如下内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w"> </span><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"> </span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>Pod<span class="w">
</span><span class="w"> </span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>demo<span class="w">
</span><span class="w"> </span><span class="k">spec</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="k">containers</span><span class="p">:</span><span class="w">
</span><span class="w">   </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>testpod<span class="w">
</span><span class="w">     </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>alpine<span class="p">:</span><span class="m">3.5</span><span class="w">
</span><span class="w">     </span><span class="k">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;ping&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;8.8.8.8&#34;</span><span class="p">]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>找到你创建的<code>pod.yaml</code>，在命令行运行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f pod.yaml
</code></pre></td></tr></table>
</div>
</div><p>检查你的pod已经启动并运行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods
</code></pre></td></tr></table>
</div>
</div><p>你会看到如下类似内容</p>
<pre><code>NAME      READY     STATUS    RESTARTS   AGE
demo      1/1       Running   0          4s
</code></pre>
<p>检查日志</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl logs demo
</code></pre></td></tr></table>
</div>
</div><p>会看到如下内容</p>
<pre><code>PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=37 time=21.393 ms
64 bytes from 8.8.8.8: seq=1 ttl=37 time=15.320 ms
64 bytes from 8.8.8.8: seq=2 ttl=37 time=11.111 ms
...
</code></pre>
<p>最后，销毁你的测试pod</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl delete -f pod.yaml
</code></pre></td></tr></table>
</div>
</div><h5 id="启用docker-swarm">启用Docker Swarm</h5>
<p>在命令行初始化Docker Swarm模式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"> docker swarm init
</code></pre></td></tr></table>
</div>
</div><p>如果一切正常，会看到如下内容</p>
<pre><code>Swarm initialized: current node (tjjggogqpnpj2phbfbz8jd5oq) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-3e0hh0jd5t4yjg209f4g5qpowbsczfahv2dea9a1ay2l8787cf-2h4ly330d0j917ocvzw30j5x9 192.168.65.3:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.
</code></pre>
<p>运行一个简单的Docker服务，该服务使用基于alpine的文件系统，并将ping隔离到8.8.8.8：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"> docker service create --name demo alpine:3.5 ping 8.8.8.8
</code></pre></td></tr></table>
</div>
</div><p>检查你的服务创建了一个运行的容器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"> docker service ps demo
</code></pre></td></tr></table>
</div>
</div><p>你应该看到如下内容：</p>
<pre><code>ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS
463j2s3y4b5o        demo.1              alpine:3.5          docker-desktop      Running             Running 8 seconds ago
</code></pre>
<p>最后查看ping进程的日志</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"> docker service logs demo
</code></pre></td></tr></table>
</div>
</div><p>如果一切正常会看到如下内容</p>
<pre><code>demo.1.463j2s3y4b5o@docker-desktop    | PING 8.8.8.8 (8.8.8.8): 56 data bytes
demo.1.463j2s3y4b5o@docker-desktop    | 64 bytes from 8.8.8.8: seq=0 ttl=37 time=13.005 ms
demo.1.463j2s3y4b5o@docker-desktop    | 64 bytes from 8.8.8.8: seq=1 ttl=37 time=13.847 ms
demo.1.463j2s3y4b5o@docker-desktop    | 64 bytes from 8.8.8.8: seq=2 ttl=37 time=41.296 ms
...
</code></pre>
<p>最后销毁你的测试服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"> docker service rm demo
</code></pre></td></tr></table>
</div>
</div><h4 id="容器化一个应用">容器化一个应用</h4>
<h5 id="配置-1">配置</h5>
<p>从GitHub上克隆一个示例项目</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">git clone -b v1 https://github.com/docker-training/node-bulletin-board
<span class="nb">cd</span> node-bulletin-board/bulletin-board-app
</code></pre></td></tr></table>
</div>
</div><p>这是一个简单的公告板应用程序，用node.js编写。在此示例中，假设您编写了此应用，现在正尝试将其容器化。</p>
<p>看一下名为<code>Dockerfile</code>的文件。Dockerfile描述了如何为容器组装私有文件系统，还可以包含一些元数据，这些元数据描述了如何基于该镜像运行容器。公告板应用程序Dockerfile如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="k">FROM</span><span class="s"> node:6.11.5    </span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /usr/src/app</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> package.json .<span class="err">
</span><span class="err"></span><span class="k">RUN</span> npm install    <span class="err">
</span><span class="err"></span><span class="k">COPY</span> . .<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> <span class="p">[</span> <span class="s2">&#34;npm&#34;</span><span class="p">,</span> <span class="s2">&#34;start&#34;</span> <span class="p">]</span>    <span class="err">
</span></code></pre></td></tr></table>
</div>
</div><p>编写Dockerfile是容器化一个应用的第一步。可以将其看作一步一步构建镜像的命令:</p>
<ol>
<li>从(<code>FROM</code>)现有的<code>node:6.11.5</code>镜像开始</li>
<li>使用<code>WORKDIR</code>可以指定所有后续操作均应从镜像文件系统中的目录<code>/usr/src/app</code>中执行（而不是主机的文件系统中）。</li>
<li>将文件<code>package.json</code>从主机复制(<code>COPY</code>)到镜像中的当前位置(<code>.</code>)（在这种情况下，复制到<code>/usr/src/app/package.json</code>）</li>
<li>在镜像文件系统中运行(<code>RUN</code>)命令<code>npm install</code>（它将读取<code>package.json</code>以确定应用程序的node依赖性，然后安装它们）</li>
<li>从主机将应用程序其余部分的源代码复制到镜像文件系统。</li>
</ol>
<p>可以看到，这些步骤与在主机上设置和安装应用程序所采取的步骤几乎相同-但是将它们描述为Dockerfile可以使我们在可移植的隔离Docker镜像中执行相同的操作。</p>
<p>上面的步骤构建了镜像的文件系统，但是Dockerfile中还有一行。<code>CMD</code>指令是我们在镜像中指定一些元数据的第一个示例，该元数据描述了如何基于该镜像运行容器。在这种情况下，这就是说该镜像应支持的容器化过程是<code>npm start</code>。</p>
<p>上面您看到的是组织一个简单的Dockerfile的好方法。始终以<code>FROM</code>命令开头，然后按照步骤构建您的私有文件系统，并以任何元数据规范作为结束。Dockerfile指令比上面我们看到的要多。有关完整列表，请参阅<a href="./docker-reference.md#dockerfile%E5%8F%82%E8%80%83">Dockerfile参考</a>。</p>
<h5 id="构建并测试镜像">构建并测试镜像</h5>
<p>确保您位于终端或Powershell的目录<code>node-bulletin-board/bulletin-board-app</code>中，构建公告板镜像：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker image build -t bulletinboard:1.0 .
</code></pre></td></tr></table>
</div>
</div><p>您会看到Docker逐步完成<code>Dockerfile</code>中的每条指令，并逐步构建镜像。如果成功，则构建过程应以如下消息结束。</p>
<pre><code>Successfully tagged bulletinboard:1.0.
</code></pre>
<p>基于新镜像启动一个容器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker container run --publish 8000:8080 --detach --name bb bulletinboard:1.0
</code></pre></td></tr></table>
</div>
</div><p>我们在这里使用了几个常见的标志：</p>
<ul>
<li><code>--publish</code>要求Docker将主机端口8000上传入的流量转发到容器的端口8080（容器具有自己的私有端口集，因此如果我们要从网络访问一个端口，则必须在此将流量转发给它）方式；否则，防火墙规则将阻止所有网络流量到达您的容器，这是默认的安全状态）。</li>
<li><code>--detach</code>要求Docker在后台运行此容器。</li>
<li><code>--name</code>使我们可以指定一个名称，在后续命令中使用该名称可以引用我们的容器，在本例中为bb。</li>
</ul>
<p>另请注意，我们没有指定我们要运行容器的进程。我们不必这样做，因为在构建Dockerfile时使用了<code>CMD</code>指令；因此，Docker知道在启动时会自动在容器内运行<code>npm start</code>进程。</p>
<p>在浏览器中的<code>localhost:8000</code>上访问您的应用程序。您应该看到公告板应用程序已启动并正在运行。在这一步，我们通常会竭尽所能，以确保我们的容器按预期的方式工作； 例如，现在是运行单元测试的时候了。</p>
<p>对公告板容器正常工作感到满意后，将其删除：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker container rm --force bb
</code></pre></td></tr></table>
</div>
</div><h4 id="部署到kubernetes">部署到Kubernetes</h4>
<h5 id="使用kubernetes-yaml描述应用">使用Kubernetes YAML描述应用</h5>
<p>Kubernetes中的所有容器都计划为<em>Pod</em>，这是一组共享资源的共享容器。此外，在实际的应用程序中，我们几乎从不创建单个pod。取而代之的是，我们的大多数工作负载都按<em>deployments</em>计划，这些部署是Kubernetes自动维护的可扩展Pod组。最后，所有Kubernetes对象都可以并且应该在称为Kubernetes YAML文件的清单中进行描述。这些YAML文件描述了Kubernetes应用程序的所有组件和配置，可用于在任何Kubernetes环境中轻松创建和销毁您的应用程序。</p>
<p>您已经在本教程的第一部分中编写了一个非常基本的Kubernetes YAML文件。让我们现在写一个稍微复杂一些的脚本，以运行和管理公告栏。将以下内容放在一个名为bb.yaml的文件中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>apps/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>Deployment<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>bb-demo<span class="w">
</span><span class="w">  </span><span class="k">namespace</span><span class="p">:</span><span class="w"> </span>default<span class="w">
</span><span class="w"></span><span class="k">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span><span class="k">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">bb</span><span class="p">:</span><span class="w"> </span>web<span class="w">
</span><span class="w">  </span><span class="k">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">bb</span><span class="p">:</span><span class="w"> </span>web<span class="w">
</span><span class="w">    </span><span class="k">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">containers</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>bb-site<span class="w">
</span><span class="w">        </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>bulletinboard<span class="p">:</span><span class="m">1.0</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>Service<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>bb-entrypoint<span class="w">
</span><span class="w">  </span><span class="k">namespace</span><span class="p">:</span><span class="w"> </span>default<span class="w">
</span><span class="w"></span><span class="k">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>NodePort<span class="w">
</span><span class="w">  </span><span class="k">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">bb</span><span class="p">:</span><span class="w"> </span>web<span class="w">
</span><span class="w">  </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">    </span><span class="k">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">	</span><span class="k">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">30001</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>在此Kubernetes YAML文件中，我们有两个对象，中间用<code>---</code>分隔：</p>
<ul>
<li><code>Deployment</code>，描述一组相同的可扩展Pod。在这种情况下，您将仅获得Pod的一个副本或副本，并且该Pod（在模板：键下进行描述）中仅包含一个容器，该容器基于上述的<code>bulletinboard:1.0</code>镜像。</li>
<li><code>NodePort</code>服务，它将流量从主机上的端口30001路由到其路由到的Pod内的端口8080，从而使您可以从网络到达公告板。</li>
</ul>
<p>还要注意，虽然Kubernetes YAML乍看起来可能很长很复杂，但几乎总是遵循相同的模式：</p>
<ul>
<li><code>apiVersion</code>，指示解析此对象的Kubernetes API</li>
<li><code>kind</code>，指示这是哪种对象</li>
<li>一些<code>metadata</code>，将名称等内容应用到对象</li>
<li><code>spec</code>，指定对象的所有参数和配置。</li>
</ul>
<h5 id="部署并检查应用">部署并检查应用</h5>
<p>在创建<code>bb.yaml</code>文件的地方打开终端</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f bb.yaml
</code></pre></td></tr></table>
</div>
</div><p>如果创建成功会看到如下内容</p>
<pre><code>deployment.apps/bb-demo created
service/bb-entrypoint created
</code></pre>
<p>列出部署内容确保工作正常</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl get deployments
</code></pre></td></tr></table>
</div>
</div><p>如果一切正常，内容应该如下</p>
<pre><code>NAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
bb-demo   1         1         1            1           48s
</code></pre>
<p>同样地，检查服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl get services
</code></pre></td></tr></table>
</div>
</div><pre><code>NAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
bb-entrypoint   NodePort    10.106.145.116   &lt;none&gt;        8080:30001/TCP   53s
kubernetes      ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          138d
</code></pre>
<p>除了默认的kubernetes服务，我们还看到了bb-entrypoint服务，该服务接受端口30001/TCP上的流量。</p>
<p>打开浏览器，访问位于<code>localhost:30001</code>的公告板；一旦满意，请删除您的应用程序：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl delete -f bb.yaml
</code></pre></td></tr></table>
</div>
</div><h4 id="部署到swarm">部署到Swarm</h4>
<p>通过输入<code>docker system info</code>并查找消息<code>Swarm: active</code>，确保在Docker桌面上启用了Swarm。</p>
<p>如果Swarm没有运行，只需在shell提示符下键入<code>docker swarm init</code>进行设置。</p>
<h5 id="使用stack文件描述应用">使用Stack文件描述应用</h5>
<p>Swarm从来不会像上一步那样创建单个容器。而是将所有Swarm工作负载安排为<em>服务</em>，这些服务是可伸缩的容器组，具有由Swarm自动维护的附加网络功能。此外，所有Swarm对象都可以并且应该在称为stack文件的清单中进行描述。 这些YAML文件描述了Swarm应用程序的所有组件和配置，可用于在任何Swarm环境中轻松创建和销毁您的应用程序。</p>
<p>让我们编写一个简单的stack文件来运行和管理公告栏。将以下内容放入名为<code>bb-stack.yaml</code>的文件中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.7&#39;</span><span class="w">    
</span><span class="w">
</span><span class="w"></span><span class="k">services</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">bb-app</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>bulletinboard<span class="p">:</span><span class="m">1.0</span><span class="w">
</span><span class="w">    </span><span class="k">ports</span><span class="p">:</span><span class="w">
</span><span class="w">	  </span>- <span class="s2">&#34;8000:8080&#34;</span><span class="w">    
</span></code></pre></td></tr></table>
</div>
</div><p>在这个Swarm YAML文件中，我们只有一个对象：<code>service</code>，描述一组可伸缩的相同容器。在这种情况下，您只会得到一个容器（默认容器），并且该容器基于上述<code>bulletinboard:1.0</code>镜像。我们还要求Swarm将所有到达开发计算机上8000端口的流量转发到公告板容器内的8080端口。</p>
<blockquote>
<p>Kubernetes服务和Swarm服务有很大的不同！尽管名称相似，但两个协调器的‘service’一词含义却截然不同。在Swarm中，服务同时提供调度和联网功能，创建容器并提供用于将流量路由到它们的工具。在Kubernetes中，调度和联网分别处理：<em>deployments</em>（或其他控制器）将容器的调度作为Pod处理，而服务仅负责将网络功能添加到这些Pod。</p>
</blockquote>
<h5 id="部署并检查应用-1">部署并检查应用</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker stack deploy -c bb-stack.yaml demo
</code></pre></td></tr></table>
</div>
</div><p>一切正常会显示如下内容</p>
<pre><code>Creating network demo_default
Creating service demo_bb-app
</code></pre>
<p>请注意，除服务外，Swarm默认还会创建一个Docker网络，以隔离作为stack一部分部署的容器。</p>
<p>列出服务以检查</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker service ls
</code></pre></td></tr></table>
</div>
</div><p>一切正常则显示如下内容</p>
<pre><code>ID                  NAME                MODE                REPLICAS            IMAGE               PORTS
il7elwunymbs        demo_bb-app         replicated          1/1                 bulletinboard:1.0   *:8000-&gt;8080/tcp
</code></pre>
<p>访问<code>localhost:8000</code>，如果满意，可以删除应用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker stack rm demo
</code></pre></td></tr></table>
</div>
</div><h4 id="在docker-hub上共享您的容器化应用程序">在Docker Hub上共享您的容器化应用程序</h4>
<p>在<a href="https://hub.docker.com/signup">https://hub.docker.com/signup</a>创建一个帐号，然后新建一个仓库</p>
<p>在命令行登录你的帐号</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker login
</code></pre></td></tr></table>
</div>
</div><p>镜像必须命名为:<code>&lt;Docker Hub ID&gt;/&lt;Repository Name&gt;:&lt;tag&gt;</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker image tag bulletinboard:1.0 yourDockerID/bulletinboard:1.0
</code></pre></td></tr></table>
</div>
</div><p>最后，推送镜像到Docker Hub</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker image push gordon/bulletinboard:1.0
</code></pre></td></tr></table>
</div>
</div><h3 id="最佳实践">最佳实践</h3>
<h4 id="保持镜像小巧">保持镜像小巧</h4>
<h4 id="持久化应用数据">持久化应用数据</h4>
<h4 id="使用cicd测试并部署">使用CI/CD测试并部署</h4>
<h2 id="配置网络">配置网络</h2>
<h2 id="管理应用数据">管理应用数据</h2>
<p>Docker为容器提供了两个选项来将文件存储在主机中，这样即使容器停止后文件也可以持久保存：<em>volumes</em>和<em>bind mounts</em>。如果您在Linux上运行Docker，则还可以使用<em>tmpfs</em>挂载。如果您在Windows上运行Docker，则还可以使用<em>named pipe</em>。</p>
<h3 id="选择正确的类型">选择正确的类型</h3>
<p><strong>Volumes</strong>存储在由Docker管理的主机文件系统的一部分中（在Linux上为<code>/var/lib/docker/volumes/</code>）。非Docker进程不应修改文件系统的这一部分。卷是在Docker中持久保存数据的最佳方法。</p>
<p><strong>Bind mounts</strong>可以存储在主机系统上的任何位置。它们甚至可能是重要的系统文件或目录。Docker主机或Docker容器上的非Docker进程可以随时对其进行修改。</p>
<p><strong>tmpfs mounts</strong>仅存储在主机系统的内存中，并且永远不会写入主机系统的文件系统中。</p>
<h3 id="volumes">Volumes</h3>
<p>卷是用于持久化由Docker容器生成和使用的数据的首选机制。绑定挂载取决于主机的目录结构，但是卷完全由Docker管理。</p>
<h4 id="选择-v或--mount">选择-v或&ndash;mount</h4>
<p><code>-v</code>或<code>--volume</code>：由三个字段组成，以冒号（<code>:</code>)分隔。这些字段必须以正确的顺序排列，并且每个字段的含义不是立即显而易见的。</p>
<ul>
<li>对于命名卷，第一个字段是卷的名称，在给定的主机上是唯一的。对于匿名卷，将省略第一个字段。</li>
<li>第二个字段是文件或目录在容器中的安装路径。</li>
<li>第三个字段是可选的，并且是选项的逗号分隔列表，例如ro。这些选项将在下面讨论。</li>
</ul>
<p><code>--mount</code>：由多个键/值对组成，用逗号分隔，每对均由一个<code>&lt;key&gt;=&lt;value&gt;</code>元组组成。 <code>--mount</code>语法比<code>-v</code>或<code>--volume</code>更为冗长，但是键的顺序并不重要，并且标志的值更易于理解。</p>
<ul>
<li>挂载的<code>type</code>，可以是<code>bind</code>，<code>volume</code>或<code>tmpfs</code>。本主题讨论卷，因此类型始终是卷。</li>
<li>挂载的<code>source</code>。对于命名卷，这是卷的名称。对于匿名卷，将省略此字段。可以指定为源或src。</li>
<li><code>destination</code>将文件或目录在容器中的安装路径作为其值。可以指定为<code>destination</code>,<code>dst</code>,或<code>target</code>。</li>
<li><code>readonly</code>选项（如果存在）使绑定安装以只读方式安装到容器中。</li>
<li>可以多次指定的<code>volume-opt</code>选项，采用由选项名称及其值组成的键值对。</li>
</ul>
<p>如果您的卷驱动程序接受逗号分隔的列表作为选项，则必须从外部CSV解析器中转义该值。要转义volume-opt，请用双引号（<code>&quot;</code>）括起来，并用单引号（<code>'</code>）括住整个安装参数。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker service create <span class="se">\
</span><span class="se"></span>     --mount <span class="s1">&#39;type=volume,src=&lt;VOLUME-NAME&gt;,dst=&lt;CONTAINER-PATH&gt;,volume-driver=local,volume-opt=type=nfs,volume-opt=device=&lt;nfs-server&gt;:&lt;nfs-path&gt;,&#34;volume-opt=o=addr=&lt;nfs-address&gt;,vers=4,soft,timeo=180,bg,tcp,rw&#34;&#39;</span>
    --name myservice <span class="se">\
</span><span class="se"></span>    &lt;IMAGE&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="创建和管理volume">创建和管理volume</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 创建</span>
docker volume create my-vol
<span class="c1"># 列出</span>
docker volume ls
<span class="c1"># 检查</span>
docker volume inspect my-vol
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">&#34;Driver&#34;</span>: <span class="s2">&#34;local&#34;</span>,
        <span class="s2">&#34;Labels&#34;</span>: <span class="o">{}</span>,
        <span class="s2">&#34;Mountpoint&#34;</span>: <span class="s2">&#34;/var/lib/docker/volumes/my-vol/_data&#34;</span>,
        <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;my-vol&#34;</span>,
        <span class="s2">&#34;Options&#34;</span>: <span class="o">{}</span>,
        <span class="s2">&#34;Scope&#34;</span>: <span class="s2">&#34;local&#34;</span>
    <span class="o">}</span>
<span class="o">]</span>
<span class="c1"># 移除</span>
docker volume rm my-vol
</code></pre></td></tr></table>
</div>
</div><h4 id="用volume启动容器">用Volume启动容器</h4>
<p>如果您使用尚不存在的卷启动容器，则Docker将为您创建该卷。</p>
<p>以下案例用-v和&ndash;mount两种方式演示</p>
<p><strong>&ndash;mount</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">docker run -d <span class="se">\
</span><span class="se"></span>--name devtest <span class="se">\
</span><span class="se"></span>--mount <span class="nv">source</span><span class="o">=</span>myvol2,target<span class="o">=</span>/app <span class="se">\
</span><span class="se"></span>nginx:latest
</code></pre></td></tr></table>
</div>
</div><p><strong>-v</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">docker run -d <span class="se">\
</span><span class="se"></span>--name devtest <span class="se">\
</span><span class="se"></span>-v myvol2:/app <span class="se">\
</span><span class="se"></span>nginx:latest
</code></pre></td></tr></table>
</div>
</div><p>用<code>docker inspect devtest</code>命令查看其<code>Mounts</code>部分以确认卷被创建并正确加载</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="s2">&#34;Mounts&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&#34;Type&#34;</span><span class="p">:</span> <span class="s2">&#34;volume&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;myvol2&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Source&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/lib/docker/volumes/myvol2/_data&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Destination&#34;</span><span class="p">:</span> <span class="s2">&#34;/app&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Driver&#34;</span><span class="p">:</span> <span class="s2">&#34;local&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Mode&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;RW&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nt">&#34;Propagation&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span>
    <span class="p">}</span>
<span class="p">]</span><span class="err">,</span>
</code></pre></td></tr></table>
</div>
</div><p>停止容器并删除卷</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker container stop devtest
$ docker container rm devtest
$ docker volume rm myvol2
</code></pre></td></tr></table>
</div>
</div><h4 id="使用volume启动服务">使用volume启动服务</h4>
<p>创建服务不支持<code>-v</code>或<code>--volume</code>，只能使用<code>--mount</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">docker service create -d <span class="se">\
</span><span class="se"></span>--replicas<span class="o">=</span><span class="m">4</span> <span class="se">\
</span><span class="se"></span>--name devtest-service <span class="se">\
</span><span class="se"></span>--mount <span class="nv">source</span><span class="o">=</span>myvol2,target<span class="o">=</span>/app <span class="se">\
</span><span class="se"></span>nginx:latest
</code></pre></td></tr></table>
</div>
</div><p>使用<code>docker service ps devtest-service</code>确认服务运行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker service ps devtest-service

ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS
4d7oz1j85wwn        devtest-service.1   nginx:latest        moby                Running             Running <span class="m">14</span> seconds ago
</code></pre></td></tr></table>
</div>
</div><p>移除服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker service rm devtest-service
</code></pre></td></tr></table>
</div>
</div><h4 id="使用只读volume">使用只读volume</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker run -d <span class="se">\
</span><span class="se"></span>--name<span class="o">=</span>nginxtest <span class="se">\
</span><span class="se"></span>--mount <span class="nv">source</span><span class="o">=</span>nginx-vol,destination<span class="o">=</span>/usr/share/nginx/html,readonly <span class="se">\
</span><span class="se"></span>nginx:latest
</code></pre></td></tr></table>
</div>
</div><p>使用<code>docker inspect nginxtest</code>命令检查</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="s2">&#34;Mounts&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&#34;Type&#34;</span><span class="p">:</span> <span class="s2">&#34;volume&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-vol&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Source&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/lib/docker/volumes/nginx-vol/_data&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Destination&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/share/nginx/html&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Driver&#34;</span><span class="p">:</span> <span class="s2">&#34;local&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Mode&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;RW&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nt">&#34;Propagation&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span>
    <span class="p">}</span>
<span class="p">]</span><span class="err">,</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="移除volume">移除volume</h4>
<p>容器被删除时，自动移除匿名volume，保留命名的volume</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker run --rm -v /foo -v awesome:/bar busybox top
</code></pre></td></tr></table>
</div>
</div><p>移除全部volume</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker volume prune
</code></pre></td></tr></table>
</div>
</div><h2 id="生产环境运行">生产环境运行</h2>
<h3 id="docker对象标签">Docker对象标签</h3>
<p>标签是一种将元数据应用于Docker对象的机制。</p>
<h4 id="标签键和值">标签键和值</h4>
<p>标签是键-值对，存储为字符串。您可以为一个对象指定多个标签，但是每个键值对在一个对象内必须唯一。如果给同一个键赋予多个值，则最近写入的值将覆盖所有先前的值。</p>
<p><strong>键格式建议</strong><br>
标签键是键值对的左侧。键是字母数字字符串，可能包含句点(.)和连字符(-)。大多数Docker用户都使用其他组织创建的镜像，而且以下准则有助于防止跨对象的标签意外复制，尤其是当您计划将标签用作自动化机制时。</p>
<ul>
<li>第三方工具的作者应在每个标签键之前添加其拥有的域的反向DNS表示法，例如<code>com.example.some-label</code>。</li>
<li>未经域所有者的许可，请勿在标签键中使用域。</li>
<li><code>com.docker.*</code>, <code>io.docker.*</code> 和<code>org.dockerproject.*</code>名称空间由Docker保留供内部使用。</li>
<li>标签键应以小写字母开头和结尾，并且只能包含小写字母数字字符，句点字符(.)和连字符(-)。不允许连续的句号或连字符。</li>
<li>句点字符(.)分隔名称空间“字段”。不带名称空间的标签键保留供CLI使用，从而使CLI的用户可以使用较短的键入友好字符串来交互式地标记Docker对象。</li>
</ul>
<p>这些准则目前尚未执行，其他准则可能适用于特定用例。</p>
<p><strong>值准则</strong><br>
标签值可以包含任何可以表示为字符串的数据类型，包括（但不限于）JSON，XML，CSV或YAML。唯一的要求是使用特定于结构类型的机制，首先将值序列化为字符串。例如，要将JSON序列化为字符串，可以使用<code>JSON.stringify()</code>JavaScript方法。</p>
<p>由于Docker不会反序列化该值，因此除非您将此功能内置到第三方工具中，否则无法在按标签值查询或过滤时将JSON或XML文档视为嵌套结构。</p>
<p>更多参考关于<a href="https://docs.docker.com/config/labels-custom-metadata/#manage-labels-on-objects">如何管理对象标签</a></p>
<h4 id="镜像--容器">镜像 &amp; 容器</h4>
<h4 id="本地守护进程">本地守护进程</h4>
<h4 id="volumes-1">Volumes</h4>
<h4 id="网络">网络</h4>
<h4 id="swarm-nodes">Swarm nodes</h4>
<h4 id="swarm-services">Swarm services</h4>
<h3 id="清理未使用的docker对象">清理未使用的Docker对象</h3>
<p>Docker采用保守的方法来清理未使用的对象（通常称为“垃圾收集”），例如镜像，容器，卷和网络：除非明确要求Docker这样做，否则通常不会删除这些对象。这可能会导致Docker使用额外的磁盘空间。对于每种类型的对象，Docker提供一个<code>prune</code>命令。此外，您可以使用<code>docker system prune</code>一次清除多种类型的对象。</p>
<h4 id="清理镜像">清理镜像</h4>
<p><code>docker image prune</code>命令可让您清理未使用的镜像。默认情况下，docker image prune仅清除悬空的镜像。悬空镜像是未标记且未被任何容器引用的镜像。要删除悬空的镜像：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker image prune

WARNING! This will remove all dangling images.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
</code></pre></td></tr></table>
</div>
</div><p>要删除所有现有容器未使用的镜像，请使用<code>-a</code>标志：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker image prune -a

WARNING! This will remove all images without at least one container associated to them.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
</code></pre></td></tr></table>
</div>
</div><p>默认情况下，系统会提示您继续。要绕过提示，请使用<code>-f</code>或<code>--force</code>标志。</p>
<p>您可以使用带有<code>--filter</code>标志的过滤表达式来限制清理哪些镜像。 例如，仅考虑24小时前创建的镜像：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker image prune -a --filter <span class="s2">&#34;until=24h&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="清理容器">清理容器</h4>
<p>停止容器时，除非使用<code>--rm</code>标志将其启动，否则不会自动将其删除。要查看Docker主机上的所有容器（包括已停止的容器），请使用<code>docker ps -a</code>。您可能会惊讶地发现有多少个容器，尤其是在开发系统上！停止的容器的可写层仍会占用磁盘空间。要清理此问题，可以使用<code>docker container prune</code>命令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker container prune

WARNING! This will remove all stopped containers.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
</code></pre></td></tr></table>
</div>
</div><p>默认情况下，系统会提示您继续。要绕过提示，请使用<code>-f</code>或<code>--force</code>标志。</p>
<p>默认情况下，所有停止的容器都将被删除。您可以使用<code>--filter</code>标志来限制范围。例如，以下命令仅删除24小时以上的已停止容器：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker container prune --filter <span class="s2">&#34;until=24h&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="清理卷">清理卷</h4>
<p>卷可由一个或多个容器使用，并占用Docker主机上的空间。卷不会自动删除，因为这样做可能会破坏数据。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker volume prune

WARNING! This will remove all volumes not used by at least one container.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
</code></pre></td></tr></table>
</div>
</div><p>默认情况下，系统会提示您继续。要绕过提示，请使用<code>-f</code>或<code>--force</code>标志。</p>
<p>默认情况下，将删除所有未使用的卷。您可以使用<code>--filter</code>标志来限制范围。例如，以下命令仅删除未使用<code>keep</code>标签标记的卷：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker volume prune --filter <span class="s2">&#34;label!=keep&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="清理网络">清理网络</h4>
<p>Docker网络不会占用太多磁盘空间，但是它们确实会创建<code>iptables</code>规则，桥接网络设备和路由表条目。为了清理这些问题，您可以使用<code>docker network prune</code>清理所有容器未使用的网络。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker network prune

WARNING! This will remove all networks not used by at least one container.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
</code></pre></td></tr></table>
</div>
</div><p>默认情况下，系统会提示您继续。要绕过提示，请使用<code>-f</code>或<code>--force</code>标志。</p>
<p>默认情况下，将删除所有未使用的网络。 您可以使用<code>--filter</code>标志来限制范围。例如，以下命令仅删除早于24小时的网络：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker network prune --filter <span class="s2">&#34;until=24h&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="清理一切">清理一切</h4>
<p><code>docker system prune</code>命令是用于修剪镜像，容器和网络的快捷方式。在Docker 17.06.0及更早版本中，还修剪了卷。在Docker 17.06.1及更高版本中，必须为<code>docker system prune</code>指定<code>--volumes</code>标志以修剪卷。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker system prune

WARNING! This will remove:
        - all stopped containers
        - all networks not used by at least one container
        - all dangling images
        - all build cache
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
</code></pre></td></tr></table>
</div>
</div><p>如果您使用的是Docker 17.06.1或更高版本，并且还希望修剪卷，请添加<code>--volumes</code>标志：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ docker system prune --volumes

WARNING! This will remove:
        - all stopped containers
        - all networks not used by at least one container
        - all volumes not used by at least one container
        - all dangling images
        - all build cache
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
</code></pre></td></tr></table>
</div>
</div><p>默认情况下，系统会提示您继续。要绕过提示，请使用<code>-f</code>或<code>--force</code>标志。</p>
<h3 id="格式化命令并输出日志">格式化命令并输出日志</h3>
<!-- raw HTML omitted -->
<h3 id="安全">安全</h3>
<h4 id="保护docker守护进程套接字">保护Docker守护进程套接字</h4>
<p>默认情况下，Docker通过非网络UNIX套接字运行。它还可以选择使用HTTP套接字进行通信。</p>
<p>如果您需要以安全的方式通过网络访问Docker，则可以通过指定tlsverify标志并将Docker的tlscacert标志指向受信任的CA证书来启用TLS。</p>
<p>在守护程序模式下，它仅允许来自由该CA签名的证书验证的客户端的连接。 在客户端模式下，它仅连接到具有该CA签名的证书的服务器。</p>
<blockquote>
<p>使用TLS和管理CA是一个高级主题。 在生产中使用OpenSSL，x509和TLS之前，请先熟悉一下它们。</p>
</blockquote>
<p><strong>使用OpenSSL创建CA，服务器和客户端密钥</strong></p>
<blockquote>
<p>注意：在以下示例中，将<code>$HOST</code>的所有实例替换为Docker守护程序主机的DNS名称。</p>
</blockquote>
<p>首先，在Docker守护程序的主机上，生成CA私钥和公钥：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ touch ~/.rnd <span class="o">&amp;&amp;</span> mkdir .ssl <span class="o">&amp;&amp;</span> <span class="nb">cd</span> .ssl
$ openssl genrsa -aes256 -out ca-key.pem <span class="m">4096</span>
<span class="c1">#Enter pass phrase for ca-key.pem:dockerwx</span>
$ openssl req -new -x509 -days <span class="m">365</span> -key ca-key.pem -sha256 -out ca.pem
<span class="c1"># Country Name (2 letter code) [AU]:</span>
<span class="c1"># State or Province Name (full name) [Some-State]:Queensland</span>
<span class="c1"># Locality Name (eg, city) []:Brisbane</span>
<span class="c1"># Organization Name (eg, company) [Internet Widgits Pty Ltd]:Docker Inc</span>
<span class="c1"># Organizational Unit Name (eg, section) []:Sales</span>
<span class="c1"># Common Name (e.g. server FQDN or YOUR name) []:$HOST</span>
<span class="c1"># Email Address []:Sven@home.org.au</span>
</code></pre></td></tr></table>
</div>
</div><p>现在您已经有了CA，您可以创建服务器密钥和证书签名请求（CSR）。 确保 “Common Name” 与您用于连接Docker的主机名匹配：</p>
<blockquote>
<p>注意：在以下示例中，将<code>$HOST</code>的所有实例替换为Docker守护程序主机的DNS名称。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ openssl genrsa -out server-key.pem <span class="m">4096</span>
$ openssl req -subj <span class="s2">&#34;/CN=</span><span class="nv">$HOST</span><span class="s2">&#34;</span> -sha256 -new -key server-key.pem -out server.csr
</code></pre></td></tr></table>
</div>
</div><p>接下来，我们将用我们的CA签署公钥：</p>
<p>由于可以通过IP地址和DNS名称建立TLS连接，因此在创建证书时需要指定IP地址。 例如，要允许使用10.10.10.20和127.0.0.1的连接：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">echo</span> <span class="nv">subjectAltName</span> <span class="o">=</span> DNS:<span class="nv">$HOST</span>,IP:10.10.10.20,IP:127.0.0.1 &gt;&gt; extfile.cnf
</code></pre></td></tr></table>
</div>
</div><p>将Docker守护进程密钥的扩展使用属性设置为仅用于服务器身份验证：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">echo</span> <span class="nv">ExtendedKeyUsage</span> <span class="o">=</span> serverAuth &gt;&gt; extfile.cnf
</code></pre></td></tr></table>
</div>
</div><p>现在，生成签名证书：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ openssl x509 -req -days <span class="m">365</span> -sha256 -in server.csr -CA ca.pem -CAkey ca-key.pem <span class="se">\
</span><span class="se"></span>  -CAcreateserial -out server-cert.pem -extfile extfile.cnf
Signature ok
<span class="nv">subject</span><span class="o">=</span>/CN<span class="o">=</span>your.host.com
Getting CA Private Key
Enter pass phrase <span class="k">for</span> ca-key.pem:
</code></pre></td></tr></table>
</div>
</div><p>/etc/ssl/openssl.cnf添加如下内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[req]
req_extensions = v3_req
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Weixin</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2019-06-20
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/sqlserver-admin/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Sqlserver管理</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/mysql-admin/">
            <span class="next-text nav-default">MySQL数据库管理</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  <div class="post bg-white">
      <div id="comments-gitment"></div>
      <link rel="stylesheet" href="/lib/gitment/gitment-0.0.3.min.css">
        <script src="/lib/gitment/gitment-0.0.3.min.js"></script>
      <script type="text/javascript">
      const gitment = new Gitment({
        id: 'docker-basics.md',
        title: 'Docker基础',
        link: decodeURI(location.href),
        desc: 'Docker基础 安装与配置 安装 步骤 下载\u0026amp;安装 1 2 3 # https:\/\/download.docker.com\/linux\/static\/stable\/ curl https:\/\/download.docker.com\/linux\/static\/stable\/x86_64\/docker-19.03.5.tgz -o docker-19.03.5.tgz \u0026amp;\u0026amp; mkdir docker \u0026amp;\u0026amp; tar xzf docker-19.03.5.tgz -C docker --strip-components=1 sudo mv docker \/usr\/local\/bin 启动 1 2 3 4 5 6 7 8 # 1. Start the Docker daemon sudo dockerd \u0026amp; # 2.',
        owner: 'yanweixin',
        repo: 'comments-for-yanweixin',
        oauth: {
          client_id: '4fcc40337476b3ed92f0',
          client_secret: 'a74e95bfeeeac10673b57c6b84b8f75d7628a0d7'
        }
      })
      gitment.render('comments-gitment')
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>
    </div>

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:yanweixin@zoho.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>


<a href="https://yanweixin.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Weixin
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











  <script>
    $("#openSearch, #openSearchMobile").click(function(){
      $(".modal-dialog").addClass("visible");
    });

    $("#closeSearch").click(function(){
      $(".modal-dialog").removeClass("visible");
    });

    $(document).click(function(event) {
    
      if (!$(event.target).closest(".modal-content, #openSearch, #openSearchMobile").length) {
        $("body").find(".modal-dialog").removeClass("visible");
      }
    });
  </script>





</body>
</html>
